This is feature-complete and unit-tested, but not documented, and also it has some smoke test code that I need to take out.
